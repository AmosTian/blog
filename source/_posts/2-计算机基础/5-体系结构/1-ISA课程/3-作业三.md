---
title: 流水线1
categories:
  - 计算机基础
  - 体系结构
tags:
  - 计算机基础
  - 体系结构
abbrlink: 1779141456
date: 2023-04-15 11:53:00
---

# 三、流水线1

## 1. 流水线

观察以下程序:
```
MUL R3 R1,R2
ADD R5 R4,R3
ADD R6 R4,R1
MUL R7 R8,R9
ADD R4 R3,R7
MUL R10 R5,R6 
```

对于所有上述的机器模型，采用以下 4 阶段的基本指令周期:
- Fetch 取指 (1 个时钟周期) 
- Decode 译码 (1 个时钟周期) 
- Excute 执行
	MUL(5 个时钟周期)
	ADD(2 个时钟周期) 乘法器和加法器内部不是流水线的
- Write 写回 (2 个时钟周期)

分别计算该程序在以下的机器上执行时花费的时钟周期数：

### (a) 非流水线机器

$6\times (1+1+2)+3\times 5+3\times 2=45个时钟周期$ 

### (b) 采用计分板(scoreboarding)的流水线机器，有 5 个加法器、5 个乘法器，没有数据转发逻辑 

```
F D E E E E E W W
  F D . . . . . . D E E W W
    F D E E W W
      F D E E E E E W W
        F D . . . . . . D E E W W
          F D . . . . . . . D E E E E E W W 
```
共 22时钟周期

### (c) 采用计分板(scoreboarding)的流水线机器，有 5 个加法器、5 个乘法器，带数据转发逻辑 

```
F D E E E E E W W
  F D . . . . E E W W
    F D E E W W
      F D E E E E E W W
        F D . . . . E E W W
          F D . . E E E E E E W W
```
共 16 个时钟周期

### (d) 采用计分板(scoreboarding)的流水线机器，有 1 个加法器、1 个乘法器，没有数据转发逻辑 
```
F D E E E E E W W
  F D . . . . . . D E E W W 
    F . . . . . . . D . E E W W
	                F D E E E E E W W
		              F D . . . . . . D E E W W
						  F . . . . . . D E E E E E W W
```
共 28 个时钟周期

### (e) 采用计分板(scoreboarding)的流水线机器，有 1 个加法器、1 个乘法器，带数据转发逻辑 

```
F D E E E E E W W
  F D . . . . E E W W
    F . . . . . D E E W W
	            F D E E E E E W W
	              F D . . . . E E W W
	                F . . . . D E E E E E W W
```

共 22 个时钟周期

## 2. 延迟槽

一台五阶段流水线的机器，五个流水段分别是:取指、译码、执行、访存和写回。该机器采用延迟槽技术处理控制相关。无条件分支和有条件分支都在执行阶段获得分支的结果。

### (a) 需要多少个延迟槽才能够确保正确的操作?

都在执行阶段获得分支结果
故需要两个延迟槽才能确保正确的操作


### (b) 按照你在(a)中设计的延迟槽数量，下列汇编指令序列中，哪(些)条指令可以放入延迟槽?请使 用合适的延迟槽填充方案重写下边的汇编指令代码。

#### (1)
```
ADD R5 R4, R3
OR R3 R1,R2 
SUB R7 R5, R6 
J   X

OR R3 R1,R2
SUB R7 R5,R6

LW R10 (R7) 
ADD R6 R1, R2 
X:
```

#### (2)

```
ADD R5 R4, R3 
OR R3R1,R2 
SUB R7 R5, R6 
BEQ R5 R7, X 

OR R3 R1,R2
NOP

LW R10 (R7) 
ADD R6 R1, R2 
X:
```

#### (3)
```
ADD R2 R4, R3 
OR R5 R1,R2 
SUB R7 R5, R6
BEQ R5 R7, X

NOP
NOP

LW R10 (R7) 
ADD R6 R1, R2 X:
```

### (c) 你能修改流水线减少延迟槽的数量吗(不使用分支预测的技术)? 请清楚地说明你的方法并解释为什 么这样能减少延迟槽。

将取指，译码合并为一个流水段，则延迟槽数量减少为1